set nocompatible
set encoding=utf8
set numberwidth=2 " Sets the line numbers to 2 spacesset tabstop=2
set shiftwidth=2

set tabstop=2
set shiftwidth=2
set softtabstop=2

set expandtab
set smartindent
set autoread
set autoindent
set showmatch " Matches parenthesis
set cursorline
set clipboard=unnamed
autocmd BufWritePre * :%s/\s\+$//e " Removes whitespaces on save
set splitright  " Defaults splitting to right side
set nobackup
set nowb
set guioptions=     " Removes scrollbars in MacVim

" ======= Onivim defaults ====
set number
set noswapfile
set smartcase

" Turn off statusbar, because it is externalized
set noshowmode
set noruler
set laststatus=0
set noshowcmd

" Enable GUI mouse behavior
set mouse=a

set list
set listchars=trail:·

colorscheme onedark

" ======= Plugins ========
" Set the runtime path to include Vundle and initialize
set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()

Plugin 'gmarik/Vundle.vim'
Plugin 'kien/ctrlp.vim'  " Fuzzy search
Plugin 'scrooloose/nerdtree'  " Sidebar for dir tree
Plugin 'tomtom/tcomment_vim'
Plugin 'tpope/vim-surround'       " No, not for surround system.
Plugin 'tpope/vim-fugitive'       " Git
Plugin 'airblade/vim-gitgutter'   " See which files changed
Plugin 'ternjs/tern_for_vim'      " Code analysis support for JS using Tern
Plugin 'junegunn/fzf', { 'dir': '~/.fzf', 'do': './install --all' }
Plugin 'junegunn/fzf.vim'
Plugin 'mileszs/ack.vim'
Plugin 'editorconfig/editorconfig-vim'
Plugin 'easymotion/vim-easymotion'

" Languages support
Plugin 'pangloss/vim-javascript'
Plugin 'MaxMEllon/vim-jsx-pretty'
Plugin 'vim-python/python-syntax'
Plugin 'davidhalter/jedi-vim'
Plugin 'w0rp/ale'
Plugin 'prettier/vim-prettier', { 'do': 'yarn install' }
Plugin 'digitaltoad/vim-pug'
Plugin 'wavded/vim-stylus'

call vundle#end()

" ===== Mapping ========
let mapleader=','
set backspace=indent,eol,start  " Make backspace behave normally
imap <C-o> <esc>o
" Navigate between buffers
map <C-J> :bprev<CR>
map <C-K> :bnext<CR>
map <leader>w :bp<bar>sp<bar>bn<bar>bd<CR> " Moves to another buffer and deletes the one it moved from
nnoremap p p=`] " Respects indentation on paste.
vnoremap > >gv " Retains visiual selection after indentation
vnoremap < <gv
nnoremap \ :Ack<SPACE>
nnoremap <leader>c :noh<CR>

" Some useful Tern mapping
nnoremap <leader>td :TernDef<CR>
nnoremap <leader>tr :TernRefs<CR>
nnoremap <leader>tn :TernRename<CR>

" ======= Search ========
set hlsearch  " Highlights found words in search
set wildignore+=*.log,*.sql,*.cache
set wildignore+=*/tmp/*                                     " ctrlp - ignore files in tmp directories
set wildignore+=*/target/*                                  " ctrlp - ignore files in target directories
set wildignore+=*/build/*                                   " ctrlp - ignore gradle build directories
set wildignore+=*.so                                        " ctrlp - ignore .so files
set wildignore+=*.o                                         " ctrlp - ignore .o files
set wildignore+=*.class                                     " ctrlp - ignore .class files
set wildignore+=*.swp                                       " ctrlp - ignore .swp files
set wildignore+=*.zip                                       " ctrlp - ignore .zip files
set wildignore+=*.pdf                                       " ctrlp - ignore .pdf files
set wildignore+=*/node_modules/*                            " ctrlp - ignore node modules
set wildignore+=*/bower_components/*                        " ctrlp - ignore bower components
set wildignore+=*/dist/*                                    " ctrlp - ignore grunt build directory
set wildignore+=*/.vim/

" ===== ctrlp config =========
let g:ctrlp_show_hidden = 1
let g:ctrlp_max_files=0
let g:ctrlp_max_depth=40
let g:ctrlp_by_filename = 0

" " ======= ale (linting) config ====
let g:ale_sign_error = '●' " Less aggressive than the default '>>'
let g:ale_sign_warning = '.'
let g:ale_lint_on_enter = 0 " Less distracting when opening a new file
let g:ale_linters = {
\   'javascript': ['eslint'],
\}

let g:python_highlight_string_formatting = 1
let g:python_highlight_string_format = 1
let g:python_highlight_string_templates = 1
let g:python_highlight_indent_errors = 1
let g:python_highlight_space_errors = 1
let g:python_highlight_class_vars = 1
let g:python_highlight_operators = 1

" ======= NERDTree config =======
let NERDTreeShowHidden=1
nmap <leader>s :NERDTreeFind<CR>  " Reveal current file
nmap <leader>b :NERDTreeToggle<CR> " Toggles dir tree

let g:EditorConfig_exclude_patterns = ['fugitive://.*']

" ===== ctrp + ag (the_silver_searcher) =====
if executable('ag')
  " Use Ag over Grep
  set grepprg=ag\ --nogroup\ --nocolor
  let g:ackprg = 'ag --vimgrep'
  " Use ag in CtrlP for listing files. Lightning fast and respects .gitignore
  let g:ctrlp_user_command = 'ag %s -l --nocolor -g ""'
endif

" Copied from https://github.com/w0rp/ale#generating-vim-help-files
" Put these lines at the very end of your vimrc file.

" Load all plugins now.
" Plugins need to be added to runtimepath before helptags can be generated.
packloadall
" Load all of the helptags now, after plugins have been loaded.
" All messages and errors will be ignored.
silent! helptags ALL
